!function(e){"use strict";function t(t,n,i,r,o){function a(t){var n={};return e.forEach(t,function(e){n[e]={},n[e].templateUrl=p+"/"+e+".html","404"!==e&&(n[e].controller=e),"layout"===e&&(n[e].views={layout:n.layout,"@layout":n.archive,"@layout.home":n.archive}),["admin","single"].indexOf(e)>-1&&(n[e].resolve=u(e))}),n}function u(e){var t={admin:c,single:d};return{lazyload:["$ocLazyLoad",t[e]]}}function c(e){return e.load("EditorNinja").then(function(){e.load("EditorNinja.upload"),e.load({files:[h+"bower_components/node-uuid/uuid.js"]})})}function d(e){return e.load({files:[h+"bower_components/marked/lib/marked.js",h+"bower_components/highlightjs/highlight.pack.js"]})}function l(t,n,i){var r=e.copy(n);return r.url=t,i&&"object"==typeof i&&(r=e.extend(r,i)),r}function s(e){return{data:{title:e}}}function g(){if(window.wechat){var e={};airpubConfigs.url&&(e.link=airpubConfigs.url),airpubConfigs.description&&(e.desc=airpubConfigs.description),airpubConfigs.name&&(e.title=airpubConfigs.name),window.wechat("friend",e),window.wechat("timeline",e),window.wechat("weibo",e)}}var f=airpubConfigs.theme||"chill",p=(airpubConfigs.themePath||"bower_components")+"/"+f,h=airpubConfigs.staticPath||"",m=a(["archive","single","admin","404","layout"]);n.otherwise("/404"),t.state("layout",l("",m.layout)).state("layout.home",l("/",m.layout)).state("layout.pager",l("/page/:page",m.archive)).state("layout.single",l("/article/:uri",m.single)).state("layout.create",l("/create",m.admin,s("写新文章"))).state("layout.update",l("/article/:uri/update",m.admin,s("更新文章"))).state("layout.404",l("/404",m[404])),r.config({modules:[{name:"EditorNinja",files:[h+"bower_components/ninja/dist/ninja.min.js",h+"bower_components/ninja/dist/ninja.min.css"]},{name:"EditorNinja.upload",files:[h+"bower_components/ninja/dist/ninja.min.js"]}]}),i.hashPrefix(airpubConfigs.hashPrefix||"!"),airpubConfigs.html5Mode&&i.html5Mode(!0),airpubConfigs.upyun&&o.config(airpubConfigs.upyun),g()}e.module("airpub",["upyun","duoshuo","ui.router","ui.bootstrap","oc.lazyLoad","ngSanitize"]).config(["$stateProvider","$urlRouterProvider","$locationProvider","$ocLazyLoadProvider","upyunProvider",t])}(window.angular,window.debug),function(e){"use strict";function t(e,t){return function(n){function i(e,t){return e="object"==typeof e?e.join(" "):e,['<section class="'+e+'">','<div class="container">','<div class="row">','<div class="col-lg-8 col-lg-offset-2">',t,"</div>","</div>","</div>","</section>"].join("\n")}function r(e){return window.hljs.highlightAuto(e).value}if(!n)return"";if(!marked)throw new Error("marked.js required!");var o={};window.hljs&&(o.highlight=r);var a=new marked.Renderer;return a.code=function(e,n,r){var o="raw-html"===n||this.options.highlight;if(this.options.highlight){var a=this.options.highlight(e,n);null!=a&&a!==e&&(r=!0,e=a)}return i("code-section",'<pre><code class="'+n+'" ng-bind="sqwswqsw">'+(o?e:t(e))+"</code></pre>")},a.html=function(e){return i("html-section",e)},a.heading=function(e,t){var n=t;return i("heading-section","<h"+n+">"+e+"</h"+n+">")},a.paragraph=function(e){return i("paragraph-section","<p>"+e+"</p>")},a.blockquote=function(e){return i("blockquote-section","<blockquote>"+e+"</blockquote>")},a.list=function(e,t){var n=t?"o":"u";return i("blockquote-section","<"+n+"l>"+e+"</"+n+"l>")},o.renderer=a,marked.setOptions(o),e.trustAsHtml(marked(n))}}e.module("airpub").filter("marked",["$sce","$sanitize",t])}(window.angular,window.debug),function(e){"use strict";function t(e){return airpubConfigs?void(e.configs=airpubConfigs):console.error(new Error("airpub 缺少必要的配置文件!"))}e.module("airpub").controller("global",["$scope",t])}(window.angular,window.debug),function(e){"use strict";function t(t,i){t.title=t.configs.name||"Airpub",t.description=t.configs.description||"just another Airpub blog",n(t.configs),i.$on("updateMeta",function(n,i){return"string"==typeof i?t.title=i:void e.forEach(i,function(e,n){t[n]=e})})}function n(e){if(window.wechat){var t=window.wechat,n={};e.url&&(n.link=e.url),e.name&&(n.title=e.name),e.description&&(n.desc=e.description),t("friend",n),t("timeline",n),t("weibo",n)}}e.module("airpub").controller("meta",["$scope","$rootScope",t])}(window.angular,window.debug),function(e){"use strict";function t(t,n,i,r,o){function a(e,n){var i=0===n.user_id;return e||i?void(t.isVisitor=!0):void(t.user=n)}function u(){t.hiddenSigninSection=!t.hiddenSigninSection}function c(e,n,r){t.alerts.push({msg:e,type:n||"success"});var o=t.alerts.length-1;return i(function(){t.closeAlert(o)},r?1e3*r:3e3),o}function d(e){t.alerts.splice(e,1)}function l(t,n){if(t&&(0===t.indexOf("http")||0===t.indexOf("https"))){var i=n||document.getElementsByTagName("header")[0];i&&e.element(i).css({"background-image":"url("+t+")"})}}t.location=r,t.state=n,t.hiddenSigninSection=!0,t.toggleSigninSection=u,t.alerts=[],t.addAlert=c,t.closeAlert=d,t.updateBackground=l,t.copyrightYear=(new Date).getFullYear(),o.on("ready",a)}function n(){}e.module("airpub").controller("layout",["$scope",n]).controller("base",["$scope","$state","$timeout","$location","$duoshuo",t])}(window.angular,window.debug),function(e){"use strict";function t(e,t,n,i){function r(e){return e&&!isNaN(parseInt(e))?parseInt(e):!1}if(e.itemsPerPage=10,e.currentPage=r(t.params.page)||1,i.$emit("updateMeta",e.configs.name),!(e.articles&&e.articles.length>0)){if(t.params.page)var o=!0,a=e.currentPage;n.get("threads/list",{page:e.currentPage,limit:e.itemsPerPage,with_content:1},function(n,i,r){return t.params.page&&(o=!1),n?e.addAlert("获取信息失败，请重试","danger"):0===i.length?t.go("layout.404"):(e.articles=i||[],e.totalItems=r.cursor.total,void(t.params.page&&(e.currentPage=a)))},function(){return t.go("layout.404")}),e.pageChanged=function(){o||t.go("layout.pager",{page:e.currentPage})}}}e.module("airpub").controller("archive",["$scope","$state","$duoshuo","$rootScope",t])}(window.angular,window.debug),function(e){"use strict";function t(e,t,r,o){var a=t.params.uri;return a?(e.articleID=a,void(e.article||r.get("threads/details",{thread_id:a},function(t,a){return t?e.addAlert("文章内容获取失败，请稍后再试...","danger"):(e.article=a,o.$emit("updateMeta",{title:a.title,description:n(a.content)}),a.meta&&a.meta.background&&e.updateBackground(a.meta.background),e.article&&i(e.article),void(a.author_id&&r.get("users/profile",{user_id:a.author_id},function(t,n){t||(e.author=n,e.author.description=n.connected_services.weibo?n.connected_services.weibo.description:null)})))},function(){return t.go("layout.404")}))):t.go("layout.404")}function n(e){var t=80;return e?e.length<=t?e:e.substr(0,t)+"...":""}function i(e){if(window.wechat){var t=42,n={};n.link=e.url,n.title=e.title,n.desc=e.content.substr(0,t)+(e.content.length>t?"...":""),e.meta&&e.meta.background&&(n.img=e.meta.background),e.meta&&e.meta.wechatSharePic&&(n.img=e.meta.wechatSharePic),airpubConfigs.wechat&&airpubConfigs.wechat.appId&&(n.app=airpubConfigs.wechat.appId),window.wechat("friend",n),window.wechat("timeline",n),window.wechat("weibo",n)}}e.module("airpub").controller("single",["$scope","$state","$duoshuo","$rootScope",t])}(window.angular,window.debug),function(e){"use strict";function t(t,n,i,r,o){function a(){o.$emit("updateMeta",n.current.data.title),i.get("sites/membership",{},function(e,r){if(e||"administrator"!==r.role)return n.go("layout.home");var o="layout.update"===n.current.name&&n.params.uri;return o?void i.get("threads/details",{thread_id:n.params.uri},function(e,n){return t.isAdmin=!0,e?t.addAlert("文章内容获取失败，请稍后再试...","danger"):void(t.article=n)},function(){return t.addAlert("文章内容获取失败，请稍后再试...","danger")}):void(t.isAdmin=!0)},function(e){t.addAlert(e.errorMessage,"danger"),n.go("layout.home")})}function u(){if(!t.isAdmin)return!1;if(!t.article.title)return t.addAlert("至少写个标题咯...","danger");if(!t.article.content)return t.addAlert("至少写点内容咯...","danger");var e={};e.format="markdown",e.title=t.article.title,e.content=t.article.content,e.thread_key=uuid.v1(),e=l(e),g("beforeCreate",e),i.post("threads/create",e,function(e,r){return e?t.addAlert("发布失败...","danger"):(t.addAlert("发布成功"),i.post("threads/update",{thread_id:r.thread_id,url:f+h+"/article/"+r.thread_id},function(e){e&&console.log(e),n.go("layout.single",{uri:r.thread_id})}),void g("afterCreate",r))},function(){return t.addAlert("发布失败...","danger")})}function c(e){if(!e)return t.createArticle();if(!t.isAdmin)return!1;var r={};r.thread_id=e,r.title=t.article.title,r.content=t.article.content,r.url=f+h+"/article/"+e,r=l(r),g("beforeUpdate",r),i.post("threads/update",r,function(i,r){return i?t.addAlert("更新失败，请稍后再试...","danger"):(t.addAlert("更新成功!"),g("afterUpdate",r),void n.go("layout.single",{uri:e}))},function(){return t.addAlert("更新失败，请稍后再试...","danger")})}function d(e){return e&&t.isAdmin?(g("beforeRemove",e),void i.post("threads/remove",{thread_id:e},function(i){return i?t.addAlert("删除失败，请稍后再试...","danger"):(g("afterRemove",e),t.addAlert("删除成功!"),void n.go("layout.home"))},function(){return t.addAlert("删除失败，请稍后再试...","danger")})):!1}function l(n){return t.article.meta?(e.forEach(t.article.meta,function(e,t){n["meta["+t+"]"]=e}),n):n}function s(e,n){return e&&n&&"function"==typeof n?(t.bindedEvents||(t.bindedEvents={}),t.bindedEvents[e]=n,t.bindedEvents):!1}function g(e,n){return t.bindedEvents&&t.bindedEvents[e]?t.bindedEvents[e](n||t.article,e):void 0}t.isAdmin=!1;var f=t.configs.url||r.host(),p=t.configs.hashPrefix||"!",h="/#"+p;a(),t.createArticle=u,t.updateArticle=c,t.removeArticle=d,t.on=s}e.module("airpub").controller("admin",["$scope","$state","$duoshuo","$location","$rootScope",t])}(window.angular,window.debug),function(){"use strict";function e(e){function t(t,n,i,r){function o(){c||(c=!0,e.upload("metaBackgroundForm",function(e,t,n){if(c=!1,e)return console.error(e),alert("上传失败，请稍后再试...");var i=200===n.code&&"ok"===n.message;i&&(a(n.absUrl),r.$setViewValue(n.absUrl))}))}function a(e){if(e&&0===e.indexOf("http")){var t=document.getElementsByTagName("header")[0],n=document.getElementById("metaBackground");if(t){var i={};i["background-image"]="url("+e+")",u(t).css(i),u(n).css(i)}}}var u=angular.element,c=!1,d=document.getElementById("uploadBackgroundBtn");u(d).on("change",o),r.$render=function(){a(r.$viewValue)}}var n={restrict:"AE",require:"ngModel",replace:!0,link:t,template:['<div id="metaBackground" class="meta-background clearfix">','<form name="metaBackgroundForm">','<input type="file" name="file" id="uploadBackgroundBtn" class="pull-left hidden-input"/>','<span class="upload-background-btn fa fa-cloud-upload">',"上传背景图片","</span>","</form>","</div>"].join("\n")};return n}function t(e){function t(e,t,n,i){function r(){i.$setViewValue(e.checkToShare)}function o(e){return function(e){return}}e.checkToShare=!1,e.updateCheckStatus=r,e.on("afterCreate",o()),e.on("afterUpdate",o())}var n={restrict:"AE",require:"ngModel",replace:!0,link:t,template:['<div id="metaShare" class="meta-share clearfix"">','<input type="checkbox" id="checkToShare" ng-model="checkToShare" ng-change="updateCheckStatus()" />','<label for="checkToShare">分享到微博</label>',"</div>"].join("\n")};return n}angular.module("airpub").directive("metaBackground",["upyun",e]).directive("metaShare",["$duoshuo",t])}();
//# sourceMappingURL=airpub.min.js.map